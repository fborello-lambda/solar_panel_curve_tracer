<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>SolarPanel-Measurements</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%2210 0 100 100%22><text y=%22.90em%22 font-size=%2290%22>üåû</text></svg>">
    </link>
    <!--
    Could be stored in a separate CSS file (with SPIFFS, same as script.js):
    <link href="/style.css" rel="stylesheet"/>
    
    But using inline CSS for simplicity.
    -->
    <style>
        :root {
            /* orange / sun theme */
            --bg: #0b1220;
            --fg: #fff8ec;
            --muted: #ffcc99;
            --accent: #ff9800;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            background: var(--bg);
            color: var(--fg);
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial
        }

        #wrap {
            max-width: 820px;
            margin: 12px auto;
            padding: 12px
        }

        h1 {
            font-size: 18px;
            margin: 0 0 8px 0;
            color: var(--fg)
        }

        /* ensure toolbar does not change chart height */
        .toolbar {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 8px;
            flex-wrap: wrap;
            flex: 0 0 auto;
            justify-content: center;
            /* do not let toolbar grow/shrink affect chartBox */
        }

        /* make chart box a fixed-height container so canvas remains steady */
        #chartBox {
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            padding: 8px;
            display: flex;
            flex-direction: column;
            height: 360px;
            /* fixed height - adjust as needed for mobile */
            min-height: 240px;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            /* fill the fixed container */
            box-sizing: border-box;
            flex: 1 1 auto;
        }

        /* touch targets */
        @media (max-width:420px) {
            canvas {
                height: 44vh;
            }
        }

        /* toolbar input label color uses CSS var instead of hard-coded hex */
        .ctrl-label {
            font-size: 12px;
            color: var(--muted);
        }

        /* solar-themed rounded buttons */
        .btn {
            display: inline-block;
            padding: 6px 12px;
            border: none;
            border-radius: 999px;
            background: linear-gradient(135deg, var(--accent), #ffb74d);
            color: var(--bg);
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 6px 14px rgba(255, 152, 0, 0.12), inset 0 -2px 0 rgba(0, 0, 0, 0.08);
            transition: transform 100ms ease, box-shadow 100ms ease, filter 120ms;
            position: relative;
            z-index: 2;
            will-change: transform;
        }

        .btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.02);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #ffb74d, #ffd199);
            color: var(--bg);
        }

        .btn.tertiary {
            background: linear-gradient(135deg, #ffa726, #ffcc80);
            color: var(--bg);
        }

        /* ensure controls wrap but don't push layout unexpectedly */
        .controls {
            overflow: visible;
            gap: 8px;
        }
    </style>
</head>

<body>
    <div id="wrap">
        <h1 align="center">Solar Panel I-V Curve üìèüìù</h1>

        <h5 class="toolbar">Set Current Range</h5>
        <div id="tb1" class="toolbar">
            <div class="controls" id="putForm" style="display:flex;align-items:center;gap:8px">
                <input id="setI" type="number" step="0.001" inputmode="decimal" style="width:90px;margin-left:6px"
                    placeholder="e.g. 12.5">
                <select id="setIUnit" class="btn tertiary" style="padding:6px 8px">
                    <option value="mA">mA</option>
                    <option value="A">A</option>
                </select>
                <button id="sendI" class="btn">Send</button>
                <span id="sendStatus" class="ctrl-label" aria-live="polite"></span>

            </div>
        </div>

        <div id="tb2" class="toolbar" style="width:100%;display:flex;justify-content:center">
            <span id="currentRange" class="ctrl-label">Range: -- mA</span>
            <span id="startMeasStatus" class="ctrl-label">Status: --</span>
            <div class="controls">
                <button id="startMeasBtn" class="btn secondary">Start Measurement</button>
            </div>
        </div>

        <div id="tb3" class="toolbar">
            <div class="controls">
                <button id="autoBtn" class="btn secondary">Auto</button>
                <button id="autoPowerBtn" class="btn secondary">Auto Power</button>
                <button id="unitBtn" class="btn tertiary">A/mA</button>
            </div>
        </div>

        <div id="chartBox">
            <canvas id="chartCanvas"></canvas>
        </div>

        <div id="tb4" class="toolbar">
            <!-- Some vspace -->
            <p></p>
            <span id="mpptCurrent" class="ctrl-label">MPPT Current: -- mA</span>
            <span id="mpptVoltage" class="ctrl-label">MPPT Voltage: -- V</span>
            <span id="info" class="ctrl-label">points: 0</span>
        </div>

    </div>

    <script src="/chart.js"></script>
    <script src="/script.js"></script>
</body>

</html>
